#include "crypto.h"
#include <iomanip>
#include <iostream>

int main() {
	UCHAR payloadText[] =
		"\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41"
		"\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41"
		"\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41"
		"\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41"
		"\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41"
		"\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41"
		"\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41";
	SIZE_T szPayload = sizeof(payloadText) - 1;

	UCHAR keyText[] = "LolIAmTheBestMalwareAuthor123456";
	SIZE_T szKey = sizeof(keyText) - 1;
	
	std::cout << szKey << std::endl;

	std::vector<UCHAR> iv = GenerateRandomIV();
	if (iv.empty()) {
		std::cerr << "[-] IV is empty." << std::endl;
		return -1;
	}

	std::cout << iv.size() << std::endl;
	std::cout << szPayload << std::endl;

	int algorithm = AES;

	Payload payload(payloadText, szPayload, keyText, szKey, iv, algorithm);

	if (!payload.Encrypt()) {
		return -1;
	}
	for (size_t i = 0; i < payload.payload.size(); i++) {
		std::cout << "\\x" << std::hex << std::setw(2) << std::setfill('0') << (int)payload.payload[i];
	}

	return 0;
}